<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="twitter:card" content="summary" /><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Deploying demo projects to Heroku | Joe Dockrill</title>
<meta name="generator" content="Jekyll v4.0.0" />
<meta property="og:title" content="Deploying demo projects to Heroku" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="How to get your shiny new model into a working demo" />
<meta property="og:description" content="How to get your shiny new model into a working demo" />
<link rel="canonical" href="https://joedockrill.github.io/blog/misc/2020/07/26/Deploying-demo-projects-to-heroku.html" />
<meta property="og:url" content="https://joedockrill.github.io/blog/misc/2020/07/26/Deploying-demo-projects-to-heroku.html" />
<meta property="og:site_name" content="Joe Dockrill" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-07-26T00:00:00-05:00" />
<script type="application/ld+json">
{"description":"How to get your shiny new model into a working demo","@type":"BlogPosting","headline":"Deploying demo projects to Heroku","url":"https://joedockrill.github.io/blog/misc/2020/07/26/Deploying-demo-projects-to-heroku.html","datePublished":"2020-07-26T00:00:00-05:00","dateModified":"2020-07-26T00:00:00-05:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://joedockrill.github.io/blog/misc/2020/07/26/Deploying-demo-projects-to-heroku.html"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/blog/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://joedockrill.github.io/blog/feed.xml" title="Joe Dockrill" /><link rel="shortcut icon" type="image/x-icon" href="/blog/images/favicon.ico"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Deploying demo projects to Heroku | Joe Dockrill</title>
<meta name="generator" content="Jekyll v4.0.0" />
<meta property="og:title" content="Deploying demo projects to Heroku" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="How to get your shiny new model into a working demo" />
<meta property="og:description" content="How to get your shiny new model into a working demo" />
<link rel="canonical" href="https://joedockrill.github.io/blog/misc/2020/07/26/Deploying-demo-projects-to-heroku.html" />
<meta property="og:url" content="https://joedockrill.github.io/blog/misc/2020/07/26/Deploying-demo-projects-to-heroku.html" />
<meta property="og:site_name" content="Joe Dockrill" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-07-26T00:00:00-05:00" />
<script type="application/ld+json">
{"description":"How to get your shiny new model into a working demo","@type":"BlogPosting","headline":"Deploying demo projects to Heroku","url":"https://joedockrill.github.io/blog/misc/2020/07/26/Deploying-demo-projects-to-heroku.html","datePublished":"2020-07-26T00:00:00-05:00","dateModified":"2020-07-26T00:00:00-05:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://joedockrill.github.io/blog/misc/2020/07/26/Deploying-demo-projects-to-heroku.html"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

<link href="https://unpkg.com/@primer/css/dist/primer.css" rel="stylesheet" />
<link rel="stylesheet" href="//use.fontawesome.com/releases/v5.0.7/css/all.css"><link type="application/atom+xml" rel="alternate" href="https://joedockrill.github.io/blog/feed.xml" title="Joe Dockrill" />

<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head>
<body>
    <img src="/blog/images/web-header-wide.png"><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/blog/">Home</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/blog/about/">About</a><a class="page-link" href="/blog/search/">Search</a><a class="page-link" href="/blog/categories/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Deploying demo projects to Heroku</h1><p class="page-description">How to get your shiny new model into a working demo</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2020-07-26T00:00:00-05:00" itemprop="datePublished">
        Jul 26, 2020
      </time>
       • <span class="read-time" title="Estimated read time">
    
    
      3 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="/blog/categories/#misc">misc</a>
        
      
      </p>
    

    
      
        <div class="pb-5 d-flex flex-wrap flex-justify-end">
          <div class="px-2">

    <a href="https://github.com/joedockrill/blog/tree/master/_notebooks/2020-07-26-Deploying-demo-projects-to-heroku.ipynb" role="button" target="_blank">
<img class="notebook-badge-image" src="/blog/assets/badges/github.svg" alt="View On GitHub">
    </a>
</div>

          
          <div class="px-2">
    <a href="https://colab.research.google.com/github/joedockrill/blog/blob/master/_notebooks/2020-07-26-Deploying-demo-projects-to-heroku.ipynb" target="_blank">
        <img class="notebook-badge-image" src="/blog/assets/badges/colab.svg" alt="Open In Colab"/>
    </a>
</div>
        </div>
      </header>

  <div class="post-content e-content" itemprop="articleBody">
    <ul class="section-nav">
</ul><!--
#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: _notebooks/2020-07-26-Deploying-demo-projects-to-heroku.ipynb
-->

<div class="container" id="notebook-container">
        
    
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>So you’ve created a deep learning model and it can understand the difference between different breeds of dog or different Hemsworth brothers. Awesome.</p>
<p>Now what? There are various options for deploying some kind of working demo.</p>
<p>Some people want to put a lot of effort into very beautifully presented standards compliant ajax enabled websites and mobile apps. That’s fine, I’m not knocking it, but life is short and personally I just want somewhere I can upload my notebook so I can go “LOOK I MADE A THING AND IT’S REALLY COOL!!”</p>
<p><a href="http://heroku.com/">Heroku</a> combined with <a href="https://voila.readthedocs.io/en/stable/index.html">Voila</a> is perfect for me. Voila renders Jupyter notebooks as web pages and Heroku is a lovely free service which lets me just throw my notebooks at it. Heroku also scales as you grow so you can start free and work your way up if you want to host something serious on it. (You can also use Heroku for proper websites if you prefer, google away).</p>
<p>If you take a look at <a href="https://github.com/joedockrill/heroku">the repo</a> for <a href="https://joedockrill.herokuapp.com/voila/render/default.ipynb">my demo site</a> on Heroku, you’ll see:</p>
<ul>
<li>Procfile – what to do when the heroku application starts</li>
<li>requirements.txt – modules you need</li>
<li>Some .ipynb notebooks</li>
</ul>
<p><strong>Procfile</strong> – mine looks like this: \
<code>web: voila –port=$PORT –no-browser –enable_nbextensions=True</code></p>
<p>If you add notebook.ipynb to the end of that string then Voila will display that notebook when the app starts <strong>but</strong> you can <em>only</em> display that notebook and if you try to link to any others you’ll get an http error. I want to use this for multiple demos so I don’t specify a notebook, but if you go to the root of the app at <a href="https://joedockrill.herokuapp.com/">joedockrill.herokuapp.com</a> then you’ll be greeted with a rather unattractive list of files.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<img src="https://joedockrill.github.io/blog/images/voila.jpg">
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Hopefully you can tell from the rather unattractive list of files where I’m headed with this. I use <code>default.ipynb</code> as a homepage to list all the demos on the website; It just means having to explicitly link to <a href="https://joedockrill.herokuapp.com/voila/render/default.ipynb">joedockrill.herokuapp.com/voila/render/default.ipynb</a> which isn’t the biggest pain in the world.</p>
<p><strong>requirements.txt</strong> is for all the modules you need. do not do pip installs in your notebook. Heroku builds an image with everything you need <strong>once</strong> when you deploy, then just copies it onto a server when someone runs the app.</p>
<p>Once you have your repo in place you just need to</p>
<ul>
<li>Create an account on Heroku</li>
<li>Connect it to your github</li>
<li>Choose the repo</li>
<li>Choose between automatic deploys when the repo changes or manual deploys when you press the button</li>
</ul>
<p>Two things to keep in mind. First, there is a maximum compiled “slug size” for your app image and it’s 500MB. If you intend to deploy multiple demos with large model files then keep the pickles on Google Drive or something similar and load them from there. You also need to make sure that you use the CPU versions of Pytorch because the GPU ones are massive by comparison. (See my <a href="https://raw.githubusercontent.com/joedockrill/heroku/master/requirements.txt">requirements.txt</a> file).</p>
<p>The other issue (related to the first) is that Voila runs <strong>all</strong> the code in your notebook before it renders that part of the UI. That’s an issue when you have to load a model export across the intertubes. You’ll see in the clown classifier that the markdown cell at the top displays right away so I waffle and talk about the demo and make excuses and hope that it’s rendered the rest of the UI by the time you finish reading.</p>
<p>I haven’t yet found a way around this and believe me I’ve tried. I even tried downloading the model from drive on a worker thread so my foreground would complete and render the UI before the download started. It works fine in Colab but Voila didn’t like it, and somehow still managed to wait until the background thread had completed before rendering anything. It was like trying to make VB5 behave itself with multi-threading APIs. I gave up.</p>
<p>Don’t get me wrong though, Voila and Heroku are both lovely and I highly recommend giving them a go. If there's a better option for a quick demo project, I haven't found it yet.</p>

</div>
</div>
</div>
</div>



  </div><!-- from https://github.com/utterance/utterances -->
<script src="https://utteranc.es/client.js"
        repo="joedockrill/blog"
        issue-term="title"
        label="blogpost-comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script><a class="u-url" href="/blog/misc/2020/07/26/Deploying-demo-projects-to-heroku.html" hidden></a>
</article>
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/blog/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/blog/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/blog/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>Mumbling About Data Science</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/joedockrill" title="joedockrill"><svg class="svg-icon grey"><use xlink:href="/blog/assets/minima-social-icons.svg#github"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
